<dom-module id="coffee-subapp">
    <style include="shared-styles"></style>
    <template>
        <paper-toast id="message"></paper-toast>
        <sweetwater-scraper id="sws"
            coffees="{{coffees}}"
            prices="{{prices}}"
            on-scrape-success="reenablebtn">
        </sweetwater-scraper>

        <h2>Coffee</h2>

        <paper-tabs selected="{{selected}}">
            <paper-tab>Coffee (<span>{{coffees.length}}</span>)</paper-tab>
            <paper-tab>Prices (<span>{{prices.length}}</span>)</paper-tab>
            <paper-tab>Other</paper-tab>
        </paper-tabs>

        <iron-pages selected="{{selected}}">

            <div>
                <ul class="horizontal layout start wrap">
                    <template is="dom-repeat" items="{{coffees}}">
                        <li>
                            <paper-material elevation="1" class="coffee">
                                <img src="{{item.img}}">
                                <em>{{item.name}}</em>
                                <currency-display value="{{item.price}}"></currency-display>
                            </paper-material>
                        </li>
                    </template>
                </ul>
            </div>

            <div>
                <ul>
                <template is="dom-repeat" items="{{prices}}" as="price">
                    <li>
                        <paper-material elevation="1" class="price">
                            <div>
                                <span>Retail:</span>
                                <currency-display value="{{price.retail}}"></currency-display>
                            </div>
                            <div class="vertical layout">
                                <paper-input label="1 lb." type="number" value="{{price.wholesale.0}}">
                                    <div prefix>$</div>
                                </paper-input>
                                <paper-input label="2 lbs." type="number" value="{{price.wholesale.1}}">
                                    <div prefix>$</div>
                                </paper-input>
                                <paper-input label="5 lbs." type="number" value="{{price.wholesale.2}}">
                                    <div prefix>$</div>
                                </paper-input>
                            </div>
                        </paper-material>
                    </li>
                </template>
                </ul>
            </div>

            <div>
                <paper-button id="scrapebtn" raised on-tap="rescan">Scrape Sweetwater</paper-button>
            </div>

        </iron-pages>
    </template>
</dom-module>
<script>
    function zip(arrays) {
        return arrays[0].map((_,i) => arrays.map(a => a[i]));
    }

    Polymer({
        is: 'coffee-subapp',
        ready: function () {
            this.selected = 0;
        },
        rescan: function () {
            this.$.scrapebtn.disabled = true;
            this.$.sws.scrape();
        },
        reenablebtn: function () {
            this.$.scrapebtn.disabled = false;
        }
    });
</script>
