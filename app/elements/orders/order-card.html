<dom-module id="order-card">
    <style>
        :hover {
            cursor: pointer;
        }
        paper-card.selected {
            background-color: var(--primary-background-color);
        }
        .spaced { padding: 0.5rem; }
        .divider { border-right: solid 1px #ccc; }
    </style>
    <template>
        <firebase-collection id="personalitems"
            location="https://swcoffee.firebaseio.com/personalitems/"
            order-by-child="order"
            equal-to="[[order.__firebaseKey__]]"
            data="{{personalitems}}">
        </firebase-collection>
        <firebase-collection id="teamitems"
            location="https://swcoffee.firebaseio.com/teamitems/"
            order-by-child="order"
            equal-to="[[order.__firebaseKey__]]"
            data="{{teamitems}}">
        </firebase-collection>
        <paper-card id="card" heading="{{toDate(order.date)}}" image="" elevation="1" animated-shadow="false" on-tap="select">
            <div class="card-content vertical layout">
                <div class="horizontal layout">
                    <div class="divider spaced">
                        <div><span>{{teamitems.length}}</span> team items</div>
                        <div><span>{{personalitems.length}}</span> personal items</div>
                    </div>
                    <div class="spaced">
                        <order-totals order="[[order]]"></order-totals>
                    </div>
                </div>
            </div>
            <div class="card-actions">
                <template is="dom-if" if="{{isOpen(order)}}">
                    <span>Accepting orders</span>
                </template>
                <template is="dom-if" if="{{isClosed(order)}}">
                    <span>Ordered</span>
                </template>
                <template is="dom-if" if="{{isPaid(order)}}">
                    <span>Accepting payment</span>
                </template>
            </div>
            <paper-ripple></paper-ripple>
        </paper-card>
    </template>
</dom-module>
<script>
    Polymer({
        is: 'order-card',
        properties: {
            order: {
                type: Object,
                notify: true
            },
            selected: {
                type: Boolean,
                value: false,
                observer: '_selectedChanged'
            }
        },
        _selectedChanged: function (newValue, oldValue) {
            if (oldValue === undefined) return;

            if (newValue) {
                this.$.card.classList.add('selected');
            } else {
                this.$.card.classList.remove('selected');
            }
        },
        select: function () {
            this.fire('order-selected', this);
        },
        isOpen: o => o.status == 'open',
        isClosed: o => o.status == 'closed',
        isPaid: o => o.status == 'paid',
        toDate: t => new Date(t).toLocaleDateString()
    });
</script>